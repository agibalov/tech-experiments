# rds-mysql-data-import-experiment

Looking for the fastest way to populate the RDS Mysql database with lots of synthetic data for performance testing.

Approaches compared are:

* [JDBC batch inserts](jdbc-batch-insert-app)
* [Mysql stored procedure: insert in a loop](stored-procedure-app)
* [Mysql "load data infile"](load-data-infile-app)

# How to deploy and run

* `envTag=dev branch=master ./tool.sh deploy` to deploy. After it, run the CodeBuild project manually. It takes ~30 minutes to run all the tests. In the very end of build log there will be a test run ID. Use this ID to get the results: `envTag=dev testRunId=123 ./tool.sh results` 
* `envTag=dev app=<APP> ./tool.sh run` to try one of the approaches:
  * `jdbc-batch-insert-app` for "JDBC batch inserts" approach.
  * `stored-procedure-app` to try the "Stored procedure" approach.
  * `load-data-infile-app` to try the "Load data infile" approach.
  
  Optionally specify `APP_SCHOOLS`, `APP_CLASSES` and `APP_STUDENTS` (`APP_SCHOOLS=100 APP_CLASSES=200 envTag=dev ./tool.sh run`)
* `envTag=dev ./tool.sh undeploy` to undeploy.

# Results

A sample test run. Time is in seconds.

| Rows              | jdbc-batch-insert | stored-procedure | load-data-infile |
| ----------------: | ----------------: | ---------------: | ---------------: |
| 8,420 (n=20)      | 8.708             | 0.678            | 0.765            |
| 33,824 (n=32)     | 28.297            | 2.009            | 2.350            |
| 65,640 (n=40)     | 55.286            | 2.237            | 2.143            |
| 127,550 (n=50)    | N/A               | 4.421            | 3.581            |
| 254,079 (n=63)    | N/A               | 8.545            | 6.841            |
| 499,359 (n=79)    | N/A               | 17.308           | 13.492           |
| 980,199 (n=99)    | N/A               | 30.485           | 25.840           |
| 2,016,378 (n=126) | N/A               | 65.100           | 55.856           |
| 4,045,119 (n=159) | N/A               | 131.757          | 122.522          |
| 8,040,200 (n=200) | N/A               | 274.708          | 251.919          |

Conclusions:

1. The "JDBC batch inserts" approach is practically not usable. The "Stored procedure" approach and the "Load data infile" approach are both practically usable and show very similar results.
2. The "Load data infile" approach wins. Not only because the numbers are slightly better, but also because the data gets generated by the Java code, which is always more flexible than the tools available to stored procedures. 
